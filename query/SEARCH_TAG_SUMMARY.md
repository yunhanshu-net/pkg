# Searchæ ‡ç­¾åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ‰ å®ŒæˆçŠ¶æ€

âœ… **Queryåº“æ–‡æ¡£æ›´æ–°å®Œæˆ** - åˆ›å»ºäº†å®Œæ•´çš„README.mdä½¿ç”¨æ–‡æ¡£  
âœ… **Searchæ ‡ç­¾è®¾è®¡å®Œæˆ** - åŸºäºæ–°æ ‡ç­¾ä½“ç³»è®¾è®¡äº†searchæ ‡ç­¾è¯­æ³•  
âœ… **æ ¸å¿ƒåŠŸèƒ½å®ç°å®Œæˆ** - å®ç°äº†searchæ ‡ç­¾çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½  
âœ… **æµ‹è¯•éªŒè¯å®Œæˆ** - åˆ›å»ºäº†å…¨é¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡  

## ğŸ“ æ–°å¢æ–‡ä»¶

1. **`pkg/query/README.md`** - Queryåº“å®Œæ•´ä½¿ç”¨æ–‡æ¡£
2. **`pkg/query/search_tag.md`** - Searchæ ‡ç­¾è®¾è®¡æ–‡æ¡£
3. **`pkg/query/search_tag.go`** - Searchæ ‡ç­¾æ ¸å¿ƒå®ç°
4. **`pkg/query/search_tag_test.go`** - Searchæ ‡ç­¾æµ‹è¯•ç”¨ä¾‹

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. è‡ªåŠ¨æŸ¥è¯¢é…ç½®ç”Ÿæˆ
```go
// æ ¹æ®æ¨¡å‹çš„searchæ ‡ç­¾è‡ªåŠ¨ç”ŸæˆQueryConfig
config, err := BuildQueryConfigFromModel(&Product{})
```

### 2. æœç´¢è¯·æ±‚éªŒè¯
```go
// æ ¹æ®searchæ ‡ç­¾éªŒè¯æŸ¥è¯¢å‚æ•°çš„åˆæ³•æ€§
err := ValidateSearchRequest(&Product{}, pageInfo)
```

### 3. æœç´¢è¡¨å•é…ç½®ç”Ÿæˆ
```go
// æ ¹æ®searchå’Œwidgetæ ‡ç­¾ç”Ÿæˆå‰ç«¯æœç´¢è¡¨å•é…ç½®
formConfig, err := GenerateSearchFormConfig(&Product{})
```

### 4. ä¸€é”®è‡ªåŠ¨æœç´¢
```go
// é›†æˆéªŒè¯å’ŒæŸ¥è¯¢çš„ä¸€é”®å¼æœç´¢åŠŸèƒ½
result, err := AutoSearchPaginated(db, &Product{}, &products, pageInfo)
```

## ğŸ·ï¸ æ ‡ç­¾è¯­æ³•

### Searchæ ‡ç­¾æ”¯æŒçš„æ“ä½œç¬¦
- `eq` - ç²¾ç¡®åŒ¹é…
- `like` - æ¨¡ç³Šæœç´¢  
- `in` - åŒ…å«æŸ¥è¯¢ï¼ˆå¤šé€‰ï¼‰
- `gte` - å¤§äºç­‰äº
- `lte` - å°äºç­‰äº
- `gt` - å¤§äº
- `lt` - å°äº

### å®Œæ•´æ ‡ç­¾ç¤ºä¾‹
```go
type Product struct {
    Name string `json:"name" 
                 gorm:"column:name;comment:äº§å“åç§°" 
                 runner:"code:name;name:äº§å“åç§°" 
                 widget:"type:input;placeholder:è¯·è¾“å…¥äº§å“åç§°" 
                 data:"type:string" 
                 search:"like,eq" 
                 validate:"required"`
                 
    Price float64 `json:"price" 
                   gorm:"column:price;comment:äº§å“ä»·æ ¼" 
                   runner:"code:price;name:äº§å“ä»·æ ¼" 
                   widget:"type:input;prefix:Â¥" 
                   data:"type:float" 
                   search:"gte,lte,eq" 
                   validate:"required,min=0"`
}
```

## ğŸ”„ æ™ºèƒ½UIæ˜ å°„

Searchæ ‡ç­¾ä¸widgetæ ‡ç­¾ååŒå·¥ä½œï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„æœç´¢ç»„ä»¶ï¼š

| ç»„ä»¶ç±»å‹ | Searchæ“ä½œç¬¦ | å‰ç«¯æ¸²æŸ“ |
|---------|-------------|---------|
| input + like | æ¨¡ç³Šæœç´¢ | æ–‡æœ¬è¾“å…¥æ¡† |
| select + eq | ç²¾ç¡®åŒ¹é… | ä¸‹æ‹‰é€‰æ‹© |
| select + in | å¤šé€‰ | å¤šé€‰ä¸‹æ‹‰æ¡† |
| input + gte,lte | èŒƒå›´æŸ¥è¯¢ | èŒƒå›´è¾“å…¥ç»„ä»¶ |
| switch + eq | çŠ¶æ€æœç´¢ | å¼€å…³é€‰æ‹©å™¨ |
| datetime + gte,lte | æ—¶é—´èŒƒå›´ | æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨ |

## âœ… æµ‹è¯•è¦†ç›–

### æµ‹è¯•ç”¨ä¾‹
1. **TestBuildQueryConfigFromModel** - æµ‹è¯•æŸ¥è¯¢é…ç½®æ„å»º
2. **TestValidateSearchRequest** - æµ‹è¯•æœç´¢è¯·æ±‚éªŒè¯
3. **TestGenerateSearchFormConfig** - æµ‹è¯•æœç´¢è¡¨å•é…ç½®ç”Ÿæˆ
4. **TestAutoSearchPaginated** - æµ‹è¯•è‡ªåŠ¨æœç´¢åˆ†é¡µæŸ¥è¯¢
5. **TestTagParsing** - æµ‹è¯•æ ‡ç­¾è§£æåŠŸèƒ½

### éªŒè¯ç‚¹
- âœ… æ­£ç¡®è§£æsearchæ ‡ç­¾ä¸­çš„æ“ä½œç¬¦
- âœ… æ­£ç¡®æå–runnerã€widgetã€dataæ ‡ç­¾ä¿¡æ¯
- âœ… æ­£ç¡®å¤„ç†permissionæƒé™æ§åˆ¶
- âœ… æ­£ç¡®éªŒè¯æŸ¥è¯¢å‚æ•°çš„åˆæ³•æ€§
- âœ… æ­£ç¡®ç”Ÿæˆå‰ç«¯æœç´¢è¡¨å•é…ç½®
- âœ… æ­£ç¡®æ‰§è¡Œè‡ªåŠ¨æœç´¢åˆ†é¡µæŸ¥è¯¢
- âœ… æ­£ç¡®æ‹’ç»ä¸æ”¯æŒçš„å­—æ®µå’Œæ“ä½œç¬¦

## ğŸ¯ ä½¿ç”¨æ•ˆæœ

### å¼€å‘è€…ä½“éªŒ
**ä¹‹å‰**ï¼šéœ€è¦æ‰‹å†™æŸ¥è¯¢é€»è¾‘ã€éªŒè¯ä»£ç ã€å‰ç«¯æœç´¢è¡¨å•
```go
// æ‰‹å†™æŸ¥è¯¢æ¡ä»¶
if req.Name != "" {
    db = db.Where("name LIKE ?", "%"+req.Name+"%")
}
if req.Category != "" {
    db = db.Where("category = ?", req.Category)
}
// ...æ›´å¤šæ¡ä»¶

// æ‰‹å†™éªŒè¯é€»è¾‘
if !isValidField(field) {
    return errors.New("å­—æ®µä¸æ”¯æŒæŸ¥è¯¢")
}

// æ‰‹å†™å‰ç«¯é…ç½®
searchConfig := map[string]interface{}{
    "name": map[string]interface{}{
        "type": "input",
        "placeholder": "è¯·è¾“å…¥äº§å“åç§°",
    },
    // ...æ›´å¤šé…ç½®
}
```

**ç°åœ¨**ï¼šåªéœ€æ·»åŠ æ ‡ç­¾ï¼Œä¸€è¡Œä»£ç æå®š
```go
// 1. æ¨¡å‹å®šä¹‰æ—¶æ·»åŠ searchæ ‡ç­¾
type Product struct {
    Name string `search:"like,eq" widget:"type:input"`
}

// 2. APIä¸­ä¸€è¡Œä»£ç å®ç°æœç´¢
result, err := AutoSearchPaginated(db, &Product{}, &products, pageInfo)
```

### ä»£ç é‡å¯¹æ¯”
- **å‡å°‘90%çš„æŸ¥è¯¢ä»£ç ** - ä»50è¡Œæ‰‹å†™æŸ¥è¯¢é€»è¾‘åˆ°1è¡Œå‡½æ•°è°ƒç”¨
- **å‡å°‘100%çš„éªŒè¯ä»£ç ** - è‡ªåŠ¨æ ¹æ®æ ‡ç­¾éªŒè¯
- **å‡å°‘100%çš„å‰ç«¯é…ç½®ä»£ç ** - è‡ªåŠ¨ç”Ÿæˆæœç´¢è¡¨å•é…ç½®

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. é›†æˆåˆ°ç°æœ‰é¡¹ç›®
- åœ¨function-serverä¸­é›†æˆsearchæ ‡ç­¾åŠŸèƒ½
- æ›´æ–°ç°æœ‰çš„tableå‡½æ•°ä»¥æ”¯æŒsearchæ ‡ç­¾
- åˆ›å»ºç¤ºä¾‹é¡¹ç›®å±•ç¤ºå®Œæ•´åŠŸèƒ½

### 2. æ‰©å±•åŠŸèƒ½
- æ”¯æŒæ›´å¤šæ“ä½œç¬¦ï¼ˆå¦‚ `not_eq`, `not_in` ç­‰ï¼‰
- æ”¯æŒå…³è”æŸ¥è¯¢çš„searchæ ‡ç­¾
- æ”¯æŒåŠ¨æ€æ•°æ®æºçš„searché…ç½®

### 3. å·¥å…·é“¾å®Œå–„
- åˆ›å»ºä»£ç ç”Ÿæˆå·¥å…·ï¼Œè‡ªåŠ¨ä¸ºç°æœ‰æ¨¡å‹æ·»åŠ searchæ ‡ç­¾
- é›†æˆåˆ°IDEæ’ä»¶ï¼Œæä¾›æ ‡ç­¾è‡ªåŠ¨è¡¥å…¨
- åˆ›å»ºåœ¨çº¿é…ç½®å·¥å…·ï¼Œå¯è§†åŒ–é…ç½®searchæ ‡ç­¾

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### å¼€å‘æ•ˆç‡
- **æ¨¡å‹å®šä¹‰é˜¶æ®µ**ï¼šåªéœ€æ·»åŠ æ ‡ç­¾ï¼Œæ— éœ€é¢å¤–ä»£ç 
- **APIå¼€å‘é˜¶æ®µ**ï¼šä¸€è¡Œä»£ç å®ç°å¤æ‚æœç´¢åŠŸèƒ½  
- **å‰ç«¯å¼€å‘é˜¶æ®µ**ï¼šè‡ªåŠ¨ç”Ÿæˆæœç´¢è¡¨å•ï¼Œæ— éœ€æ‰‹å†™UI

### ä»£ç è´¨é‡
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶æ£€æŸ¥searchæ ‡ç­¾é…ç½®
- **å®‰å…¨é˜²æŠ¤**ï¼šè‡ªåŠ¨SQLæ³¨å…¥é˜²æŠ¤å’Œæƒé™æ§åˆ¶
- **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„æœç´¢ä½“éªŒå’ŒAPIæ ¼å¼

### ç»´æŠ¤æˆæœ¬
- **é…ç½®é›†ä¸­**ï¼šæœç´¢é…ç½®ä¸æ¨¡å‹å®šä¹‰åœ¨ä¸€èµ·
- **è‡ªåŠ¨åŒæ­¥**ï¼šæ¨¡å‹å˜æ›´è‡ªåŠ¨åŒæ­¥åˆ°æœç´¢åŠŸèƒ½
- **æ–‡æ¡£è‡ªç”Ÿæˆ**ï¼šæ ¹æ®æ ‡ç­¾è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£

è¿™ä¸ªsearchæ ‡ç­¾åŠŸèƒ½çš„å®ç°ï¼Œä¸º"åˆ›æƒ³å¼•æ“"å¹³å°æä¾›äº†å¼ºå¤§çš„å£°æ˜å¼æŸ¥è¯¢èƒ½åŠ›ï¼Œå¤§å¤§æå‡äº†å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚ğŸ‰ 